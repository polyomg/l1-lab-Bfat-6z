package com.poly.lab2.Controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import com.poly.lab2.model.Product;
import java.util.ArrayList;
import java.util.List;

@Controller
@RequestMapping("/product")
public class ProductController {

// List "sống" lưu sản phẩm
private List<Product> items = new ArrayList<>();

  public ProductController() {
  // Dữ liệu mặc định ban đầu
  items.add(new Product("A", 1.0));
  items.add(new Product("B", 12.0));
  }

  @GetMapping("/form")
  public String form(Model model) {
  Product p = new Product();
  p.setName("iPhone 30");
  p.setPrice(5000.0);
  model.addAttribute("p1", p);
  model.addAttribute("p2", new Product()); // Thêm p2 rỗng để binding form
  model.addAttribute("items", items); // Truyền danh sách items
  return "product/form"; // Trả về templates/product/form.html
  }

  @PostMapping("/product/save")
  public String save(@ModelAttribute("p2") Product p, Model model) {
  if (p.getName() == null || p.getName().trim().isEmpty() || p.getPrice() == null) {
  model.addAttribute("error", "Please fill all fields!");
  return "product/form"; // Quay lại form nếu lỗi
  }
  items.add(p); // Thêm vào list
  model.addAttribute("p2", p);
  model.addAttribute("items", items); // Cập nhật danh sách
  return "product/form"; // Quay lại form với dữ liệu mới
  }
  }